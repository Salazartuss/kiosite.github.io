<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="icon" href="../ressources/pictures/favicon.ico" type = "image/x-icon">
    <nav>
        <div class="nav-barre">
            <a href="home.html">Home</a>
            <a href="discover.html">Discover</a>
            <a href="dle.html">DLE</a>
        </div>
    </nav>
    <h1 class="titre">Kionassos DLE</h1>
</head>
<body>

<div class="gameStart" id="gameStart">
    <button id="starter" onclick="mainGameLoop()">Start the game</button>
</div>

<div class="gameCore" id="gameCore">
    <label for="guess">Guess : </label>
    <input type="text" id="guess">
    <button type="button" class="button" id="tryButton">Soumettre </button>
</div>

<div id="soluce">
    <p></p>
</div>





<script type="text/javascript">
    async function loadV2() {
    const brut =  await fetch('../ressources/data/peoples.json');
    return await brut.json();
}


async function startGame(){
    const data = await loadV2()
    const keys = await Object.keys(data);
    const defKey = await [Math.floor(Math.random() * keys.length)];
    return defKey;

}

const gameSoluce = startGame();




function verif(receivedValue, soluceValue){
    return receivedValue.toLowerCase() === soluceValue.toLowerCase();
};




function mainGameLoop(){
    document.getElementById('gameStart').innerHTML = "";
    var win = false;
    const tryButton = document.getElementById('tryButton');
    const guessText = document.getElementById('guess');
    const answerText = document.getElementById('soluce');
    loadV2().then(data => {
        gameSoluce.then(
            soluces =>{
                const soluceValue = Object.keys(data)[soluces];
                tryButton.addEventListener("click", function() {

                    var textValidity = "";
                    var guessC = guessText.value.toLowerCase();
                    guessText.value = "";
                    if(Object.keys(data).includes(guessC)){


                        if(verif(guessC, soluceValue)){
                            textValidity = "good";
                        }
                        else{
                            textValidity = "bad";
                        }


                        var name = "bad";
                        var age = "bad";
                        var gender = "bad";

                        if(data[guessC][0] === data[soluceValue][0]){name = "good";}

                        if(data[guessC][1] === data[soluceValue][1]){age = "good";}

                        if(data[guessC][2]=== data[soluceValue][2]){gender = "good";}

                        const neoText = '<p> <span class="' + name +'">' + data[guessC][0] + '</span> <span class="' + age +'">' + data[guessC][1] + '</span> <span class="' + gender +'">' + data[guessC][2] + '</span></p>';

                        answerText.innerHTML =  neoText + "<br>" + answerText.innerHTML;





                        if(verif(guessC, soluceValue)){document.getElementById("gameCore").innerHTML = "<p>Vous avez gagné, la réponse était " + soluceValue+ "</p>";}

                    }
                })
            }
        )
    });
}
    </body>
    </html>
</script>
</body>
</html>
